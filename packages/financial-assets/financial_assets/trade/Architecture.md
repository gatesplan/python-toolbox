# Trade Module Architecture

## 개요
거래 정보를 주고받을 때 사용할 데이터 규약 정의

## 용어

### 계약 유형 (Contract Type)

#### Spot (현물)
즉시 결제되는 거래. 레버리지 없이 보유한 자산으로만 거래 가능.

#### Futures (선물)
레버리지를 사용하는 파생상품 거래. 포지션 개념이 있으며 청산 가격이 존재.

### 주문 유형 (Order Type)

#### Market (시장가)
현재 시장 가격으로 즉시 체결되는 주문. 가격 보장은 없지만 빠른 체결 보장.

#### Limit (지정가)
지정한 가격 이상/이하에서만 체결되는 주문. 가격 보장은 있지만 체결 보장은 없음.

### 거래 시점 (Trade Event)

거래는 여러 event를 거쳐 진행되며, 각 event 사이의 구간마다 서로 다른 데이터 구조가 필요하다.

#### 1. 주문 생성 (Order Created)
클라이언트가 주문 정보를 모아서 주문장을 생성한 시점

#### 2. 주문 전송 (Order Submitted)
주문 요청을 각각의 어댑터에 보낸 시점
- 전송~접수 사이는 블랙박스 구간으로, 서버 내부 처리 과정
- 데이터 관점에서 이 구간에 별도 구조체가 필요하지 않음
- 전송 시점의 데이터 = 생성 시점의 데이터와 동일

#### 3. 주문 접수 (Order Acknowledged)
외부의 주문 처리 행동자(실제 거래소 API, 시뮬레이션 API 등) wrapper가 주문이 접수되었다고 반환하는 시점
- 주문 ID가 할당됨
- 이 시점부터 주문이 처리자의 관리 하에 들어감

#### 4. 체결 진행 (Fill Progress)
체결이 진행될 때마다 발생하는 중간 보고 시점 이벤트
- 0% (접수됨, 미체결) → 30% (부분 체결) → 70% (부분 체결) → 100% (완전 체결)
- 체결이 일어날 때마다 반복적으로 발생

#### 5. 주문 종료 (Order Finalized)
주문이 최종 완료/취소/거부되는 시점으로, **체결 진행 이벤트의 부분집합**
- 마지막 체결 진행 이벤트 = 주문 종료
- 산출 데이터는 체결 진행과 동일한 구조
- 이후 데이터는 불변(immutable)

## 거래 세부 구분별 속성

| 시점 | 속성 | 현물-시장가 | 현물-지정가 | 선물-시장가 | 선물-지정가 | 비고 |
|------|------|----------|----------|----------|----------|------|
| 🟦 생성 | stock_address | v | v | v | v | symbol을 대체하는 추상화된 거래 주소 패턴. 각 거래소 API 요청에 맞게 ticker 이름 등을 전환 |
| 🟦 생성 | side | v | v | v | v | 'buy'\|'sell'\|'long'\|'short' |
| 🟦 생성 | quantity | v | v | v | v | 최종 거래 수량 ('최종'은 레버리지가 적용된 수량을 의미) |
| 🟦 생성 | order_type | v | v | v | v | 'limit'\|'market' |
| 🟦 생성 | client_order_id | v | v | v | v | 클라이언트가 지정하는 주문 ID (추적용) |
| 🟦 생성 | time_in_force | v | v | v | v | 'GTC'\|'IOC'\|'FOK' - 주문 유효 기간 |
| 🟦 생성 | price |  | v |  | v | 단위 가격 |
| 🟦 생성 | leverage |  |  | v | v | 레버리지 배수 (선물 거래) |
| 🟩 전송 |      |      |      |        |        |
| 🟨 접수 |      |      |      |        |        |
| 🟧 체결 |      |      |      |        |        |
| 🟥 종료 |      |      |      |        |        |

## 거래 타입별 시점 차이

### Market Order
- **[접수 ~ 체결]** 구간이 거의 없음 (접수 ≈ 체결)
- 즉시 체결되므로 취소 가능한 구간이 매우 짧음

### Limit Order
- **[접수 ~ 체결]** 구간이 길 수 있음
- 호가창에서 대기하는 동안 취소 가능
